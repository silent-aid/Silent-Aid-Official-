<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=INR"></script>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body style="background-color: black; color: white;">

    <!-- Sliding Bar -->
    <div class="slide-bar">
        <p>Support Gaza - Every contribution counts!</p>
    </div>

    <h2>Checkout</h2>
    
    <form id="checkout-form">
        <label for="name">Full Name:</label>
        <input type="text" id="name" required>

        <label for="email">Email:</label>
        <input type="email" id="email" required>

        <label for="phone">Phone Number:</label>
        <input type="tel" id="phone" required>

        <label for="address">Shipping Address:</label>
        <textarea id="address" required></textarea>

        <label for="payment-method">Payment Method:</label>
        <select id="payment-method" required>
            <option value="razorpay">Razorpay</option>
            <option value="paypal">PayPal</option>
            <option value="stripe">Stripe</option>
        </select>

        <button type="submit" id="place-order-btn">Place Order</button>
    </form>

    <!-- PayPal Button -->
    <div id="paypal-button-container"></div>

    <script>
        const totalAmount = 1000;  // Example total amount, update as needed

        // Handle form submission
        document.getElementById('checkout-form').addEventListener('submit', function (e) {
            e.preventDefault();

            // Collect customer details
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const paymentMethod = document.getElementById('payment-method').value;

            // Basic validation
            if (!name || !email || !phone || !address) {
                alert('Please fill in all fields.');
                return;
            }

            if (!validateEmail(email)) {
                alert('Please enter a valid email.');
                return;
            }

            // Send data to backend for order creation
            fetch('/create-order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name,
                    email,
                    phone,
                    address,
                    paymentMethod,
                    totalAmount
                })
            }).then(response => response.json())
              .then(data => {
                  const orderId = data.orderId;
                  proceedToPayment(paymentMethod, orderId);
              });
        });

        // Validate Email Format
        function validateEmail(email) {
            const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
            return regex.test(email);
        }

        // Payment Process (Razorpay, PayPal, Stripe)
        function proceedToPayment(paymentMethod, orderId) {
            if (paymentMethod === 'razorpay') {
                createRazorpayPayment(orderId);
            } else if (paymentMethod === 'paypal') {
                createPayPalPayment(orderId);
            } else if (paymentMethod === 'stripe') {
                createStripeSession(orderId);
            }
        }

        // Razorpay Payment (client-side)
        function createRazorpayPayment(orderId) {
            fetch(`/create-razorpay-order/${orderId}`).then(response => response.json()).then(data => {
                var options = {
                    key: 'YOUR_RAZORPAY_KEY',
                    amount: totalAmount * 100,  // Convert to paise
                    currency: "INR",
                    order_id: data.razorpay_order_id,
                    handler: function (response) {
                        saveOrderToBackend(orderId, 'razorpay', response.razorpay_payment_id);
                        window.location.href = "thankyou.html";
                    },
                    prefill: {
                        name: document.getElementById('name').value,
                        email: document.getElementById('email').value,
                        contact: document.getElementById('phone').value,
                    },
                    theme: { color: "#000" }
                };
                var rzp1 = new Razorpay(options);
                rzp1.open();
            });
        }

        // PayPal Payment (client-side)
        function createPayPalPayment(orderId) {
            paypal.Buttons({
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: { value: totalAmount }
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        saveOrderToBackend(orderId, 'paypal', details.id);
                        window.location.href = "thankyou.html";
                    });
                }
            }).render('#paypal-button-container');
        }

        // Stripe Payment (client-side)
        function createStripeSession(orderId) {
            fetch(`/create-stripe-session/${orderId}`).then(response => response.json()).then(data => {
                var stripe = Stripe('YOUR_STRIPE_PUBLIC_KEY');
                stripe.redirectToCheckout({ sessionId: data.sessionId });
            });
        }

        // Save Order to Backend after payment success
        function saveOrderToBackend(orderId, paymentMethod, transactionId) {
            fetch('/update-order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    orderId,
                    paymentMethod,
                    transactionId,
                    status: 'Paid'
                })
            }).then(response => response.json()).then(data => {
                console.log('Order updated in backend:', data);
            });
        }
    </script>
</body>
</html>
